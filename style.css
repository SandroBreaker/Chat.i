/* =============================================================================
   iOS HUMAN INTERFACE GUIDELINES - DARK MODE (OLED)
   Target: Couples App / Premium Messaging
   Designer: Senior UI Specialist
============================================================================= */

:root {
  /* --- iOS SYSTEM COLORS (Dark Mode) --- */
  --ios-bg: #000000;              /* OLED Black */
  --ios-surface: #1C1C1E;         /* Cards / Modals / Secondary Backgrounds */
  --ios-surface-2: #2C2C2E;       /* Elevated Surface */
  --ios-separator: rgba(84, 84, 88, 0.65); /* Separators */
  
  /* --- ACCENT COLORS --- */
  /* iMessage Blue - Gradient sutil para dar vida */
  --ios-blue: #0A84FF;
  --ios-blue-grad: linear-gradient(180deg, #0A84FF 0%, #007AFF 100%);
  
  /* Message Bubbles */
  --bubble-out: #0A84FF;
  --bubble-in: #262628;
  
  /* Text */
  --text-primary: #FFFFFF;
  --text-secondary: #8E8E93; /* System Gray */
  --text-placeholder: #636366;
  
  /* Status */
  --color-success: #32D74B;
  --color-danger: #FF453A;

  /* Dimensions */
  --header-height: 54px; /* Mais compacto como no iOS */
  --radius-bubble: 20px;
  --radius-surface: 12px;
  
  /* Glassmorphism */
  --glass-material: rgba(30, 30, 30, 0.85);
  --glass-border: rgba(255, 255, 255, 0.12);
}

/* --------------------------------------------------------------------------
   1. RESET & BASE
-------------------------------------------------------------------------- */
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
}

html, body {
  height: 100%;
  width: 100%;
  background-color: var(--ios-bg);
  color: var(--text-primary);
  overflow: hidden; /* App feel */
  -webkit-font-smoothing: antialiased;
}

/* Scrollbar invisível estilo iOS */
::-webkit-scrollbar { width: 0px; background: transparent; }

/* --------------------------------------------------------------------------
   2. LAYOUT STRUCTURE
-------------------------------------------------------------------------- */
.app-container {
  display: flex;
  height: 100dvh;
  width: 100vw;
  background-color: var(--ios-bg);
}

.sidebar {
  width: 360px;
  background-color: var(--ios-bg);
  border-right: 0.5px solid var(--ios-separator);
  display: flex;
  flex-direction: column;
  z-index: 20;
}

.chat-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  position: relative;
  background-color: var(--ios-bg);
}

/* Utilitários */
.hidden { display: none !important; }
.flex-center { display: flex; align-items: center; justify-content: center; }

/* Mobile Responsiveness */
@media (max-width: 768px) {
  .sidebar { width: 100%; position: absolute; inset: 0; transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1); }
  .sidebar.hidden-mobile { transform: translateX(-30%); opacity: 0; pointer-events: none; }
  
  .chat-area { 
    position: absolute; 
    inset: 0; 
    z-index: 30; 
    transform: translateX(100%); 
    transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
  }
  
  /* Quando o container ativo NÃO está hidden, trazemos ele pra tela */
  #chat-active-container:not(.hidden) {
    transform: translateX(0);
  }
  /* Ajuste no parent para permitir a animação acima */
  .chat-area { transform: none; display: flex; }
  
  /* Lógica visual de navegação iOS */
  #chat-active-container.hidden {
      display: none; /* Fallback para JS atual */
  }
}

/* --------------------------------------------------------------------------
   3. NAVIGATION BARS (Glassmorphism)
-------------------------------------------------------------------------- */
.header {
  height: var(--header-height);
  padding: 0 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  
  /* iOS Blur Effect */
  background: var(--glass-material);
  backdrop-filter: blur(25px) saturate(180%);
  -webkit-backdrop-filter: blur(25px) saturate(180%);
  
  border-bottom: 0.5px solid var(--ios-separator);
  position: sticky;
  top: 0;
  z-index: 50;
  flex-shrink: 0;
}

/* Sidebar Title - Large Title iOS style transformation handled inside header for now */
.header h3 {
  font-size: 17px;
  font-weight: 600;
  letter-spacing: -0.4px;
}

/* Header Actions */
.btn-icon {
  background: transparent;
  border: none;
  color: var(--ios-blue); /* iOS Action Color */
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px;
  border-radius: 50%;
  transition: opacity 0.2s;
}
.btn-icon:active { opacity: 0.5; }

/* Back Button (Chevron) */
#btn-back-list {
  color: var(--ios-blue);
  font-size: 17px;
  font-weight: 400;
  padding-left: 0;
  display: flex; 
  align-items: center;
  gap: 4px;
}
/* Simula o texto "Voltar" ou "Chats" padrão do iOS */
#btn-back-list::after {
  content: "Chats";
  font-family: -apple-system;
  font-size: 17px;
  margin-top: -1px;
}

/* --------------------------------------------------------------------------
   4. SEARCH BAR (iOS Native Style)
-------------------------------------------------------------------------- */
.search-container {
  padding: 10px 16px;
  background-color: var(--ios-bg); /* O search fica sob o blur do header se rolar, mas aqui é estático */
}

.search-wrapper {
  background-color: var(--ios-surface);
  border-radius: 10px;
  height: 36px;
  display: flex;
  align-items: center;
  padding: 0 8px;
  transition: background-color 0.2s;
}

.search-wrapper:focus-within {
  background-color: var(--ios-surface-2);
}

.search-wrapper input {
  background: transparent;
  border: none;
  color: var(--text-primary);
  font-size: 17px;
  margin-left: 6px;
  width: 100%;
  outline: none;
}
.search-wrapper input::placeholder { color: var(--text-secondary); }

/* --------------------------------------------------------------------------
   5. LIST ITEMS (Chats)
-------------------------------------------------------------------------- */
#users-list {
  padding-left: 16px; /* Margem esquerda para o separador */
}

.chat-list-item {
  display: flex;
  align-items: center;
  padding: 12px 16px 12px 0; /* Padding right e bottom/top apenas */
  cursor: pointer;
  position: relative;
}

/* iOS Separator Line Logic */
.chat-list-item::after {
  content: '';
  position: absolute;
  bottom: 0;
  right: 0;
  left: 60px; /* Alinhado com o texto, ignorando avatar */
  height: 0.5px;
  background-color: var(--ios-separator);
}

.chat-list-item:active {
  background-color: var(--ios-surface);
  margin-left: -16px; /* Compensar padding para highlight total */
  padding-left: 16px;
}

.avatar-container {
  width: 48px;
  height: 48px;
  margin-right: 12px;
  position: relative;
  flex-shrink: 0;
}

.avatar {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  object-fit: cover;
  background: var(--ios-surface);
}

.status-dot {
  position: absolute;
  bottom: 0;
  right: 0;
  width: 12px;
  height: 12px;
  background-color: var(--color-success);
  border: 2px solid var(--ios-bg);
  border-radius: 50%;
}

.item-content { flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 4px; }

.item-header { display: flex; justify-content: space-between; align-items: baseline; }

.item-name {
  color: var(--text-primary);
  font-weight: 600;
  font-size: 17px;
}

.item-time {
  color: var(--text-secondary);
  font-size: 14px;
  font-weight: 400;
}

.item-preview {
  color: var(--text-secondary);
  font-size: 15px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.2;
}

/* --------------------------------------------------------------------------
   6. CHAT AREA & BUBBLES (iMessage Style)
-------------------------------------------------------------------------- */
#messages-list {
  flex: 1;
  padding: 16px 12px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 2px; /* iMessage agrupa mensagens próximas */
  -webkit-overflow-scrolling: touch;
}

/* Wrapper da mensagem para alinhamento */
#messages-list > div {
  margin-bottom: 2px; /* Padrão agrupado */
}
/* Adiciona espaço maior se mudar o remetente (simulado via JS ou visualmente pelo CSS :has se suportado, mas aqui usamos margin padrão maior no wrapper JS se possível, ou CSS visual gap global) */
#messages-list > div:nth-child(n) {
  margin-top: 4px; 
}

.message-bubble {
  max-width: 75%;
  padding: 10px 16px;
  font-size: 17px;
  line-height: 1.35;
  position: relative;
  word-wrap: break-word;
}

/* OUTGOING (Eu) - Blue */
.message-out {
  background: var(--ios-blue-grad);
  color: white;
  border-radius: 18px 18px 4px 18px; /* Tail effect visual */
  /* iMessage physics pop */
  animation: pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* INCOMING (Outro) - Grey */
.message-in {
  background-color: var(--ios-incoming);
  color: var(--text-primary);
  border-radius: 18px 18px 18px 4px; /* Tail effect visual */
  animation: pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.msg-image {
  border-radius: 12px;
  max-width: 240px;
  display: block;
  margin-bottom: 4px;
}

.bubble-meta {
  font-size: 11px;
  margin-top: 4px;
  display: flex;
  justify-content: flex-end;
  opacity: 0.7;
  gap: 4px;
}
.message-in .bubble-meta { color: var(--text-secondary); }
.message-out .bubble-meta { color: rgba(255, 255, 255, 0.8); }

/* --------------------------------------------------------------------------
   7. INPUT BAR (iMessage Style)
-------------------------------------------------------------------------- */
#message-form {
  background-color: rgba(0,0,0,0.6); /* Translucidez leve */
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  padding: 8px 16px 20px 16px; /* Extra bottom padding p/ Home Indicator do iPhone */
  border-top: 0.5px solid var(--ios-separator);
  z-index: 50;
}

.input-capsule {
  display: flex;
  align-items: flex-end; /* Alinha ícones com a parte de baixo se o texto for multiline */
  gap: 12px;
}

#message-input {
  flex: 1;
  background-color: var(--ios-surface);
  border: 1px solid #333;
  border-radius: 20px;
  padding: 9px 16px;
  color: var(--text-primary);
  font-size: 17px;
  line-height: 22px;
  min-height: 38px;
  max-height: 100px;
  outline: none;
}
#message-input::placeholder { color: var(--text-placeholder); }

/* Botão de Anexo (+) */
#btn-attach {
  color: var(--text-secondary);
  background: var(--ios-surface);
  width: 32px; height: 32px;
  border-radius: 50%;
  padding: 0;
  flex-shrink: 0;
  margin-bottom: 3px;
}

/* Botão Enviar (Seta azul no círculo ou ícone) */
.btn-send {
  background: var(--ios-blue);
  color: white;
  width: 32px; height: 32px;
  border-radius: 50%;
  display: flex; 
  align-items: center; 
  justify-content: center;
  margin-bottom: 3px;
  box-shadow: 0 2px 6px rgba(10, 132, 255, 0.3);
}
.btn-send svg { width: 18px; height: 18px; margin-left: 2px; } /* Ajuste visual da seta */

/* --------------------------------------------------------------------------
   8. AUTH & MODALS (Sheet Style)
-------------------------------------------------------------------------- */
#screen-auth {
  background: var(--ios-bg);
  align-items: flex-start; /* Começa do topo */
  padding-top: 20vh;
}

/* Card de Login minimalista */
#screen-auth > div {
  background: transparent !important; /* Remove card background */
  box-shadow: none !important;
  border: none !important;
  text-align: center;
}

#auth-title {
  font-size: 34px; /* iOS Large Title */
  font-weight: 700;
  margin-bottom: 8px;
}

#auth-form input {
  background: var(--ios-surface);
  border: none;
  border-bottom: 1px solid var(--ios-separator);
  border-radius: 0;
  padding: 16px 0;
  font-size: 17px;
  color: white;
  margin-bottom: 8px;
}
#auth-form input:first-child { border-radius: 10px 10px 0 0; }
#auth-form input:last-of-type { border-radius: 0 0 10px 10px; border-bottom: none; }
/* Agrupa inputs visualmente */
#auth-form > div { margin: 0 !important; }

#auth-submit-btn {
  margin-top: 24px;
  background: var(--ios-blue);
  border-radius: 12px;
  font-size: 17px;
  font-weight: 600;
}

/* --------------------------------------------------------------------------
   9. ANIMATIONS
-------------------------------------------------------------------------- */
@keyframes pop-in {
  0% { opacity: 0; transform: scale(0.9) translateY(10px); }
  100% { opacity: 1; transform: scale(1) translateY(0); }
}

.typing-indicator {
  background: var(--ios-incoming);
  padding: 12px 16px;
  border-radius: 18px;
  border-bottom-left-radius: 4px;
  display: flex;
  gap: 4px;
  width: fit-content;
}
.typing-dot {
  width: 8px; height: 8px;
  background: var(--text-secondary);
  border-radius: 50%;
  animation: bounce 1.4s infinite;
  opacity: 0.5;
}
.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }

/* Debug Console Clean up */
#mobile-debug-console { background: #1C1C1E; border-top: 1px solid #333; font-family: 'Menlo', monospace; }
