<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <!-- Viewport otimizado para iOS Safari (evita zoom em inputs) -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Nebula Chat</title>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="style.css">

    <script type="importmap">
{
  "imports": {
    "@supabase/supabase-js": "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm",
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "react/": "https://aistudiocdn.com/react@^19.2.1/"
  }
}
</script>
</head>
<body>
    
    <input type="file" id="hidden-file-input" accept="image/*" style="display: none;" />

    <!-- Loading Screen (Minimalist Apple Logo style spinner conceptually) -->
    <div id="screen-loading" class="flex-center" style="position: absolute; inset:0; z-index: 50; background: #000;">
        <div class="typing-indicator" style="background: transparent;">
            <div class="typing-dot" style="background: #FFF;"></div>
            <div class="typing-dot" style="background: #FFF;"></div>
            <div class="typing-dot" style="background: #FFF;"></div>
        </div>
    </div>

    <!-- Auth Screen (iOS Full Screen Sheet style) -->
    <div id="screen-auth" class="hidden" style="position: absolute; inset:0; z-index: 40; display: flex; justify-content: center;">
        
        <div style="width: 100%; max-width: 360px; padding: 20px;">
            
            <div style="text-align: center; margin-bottom: 40px;">
                <h1 id="auth-title">Welcome</h1>
                <p class="text-secondary" style="color: var(--text-secondary);">Sign in to connect with your partner.</p>
            </div>

            <div id="auth-error" class="hidden" style="color: var(--color-danger); margin-bottom: 20px; text-align: center; font-size: 14px;"></div>

            <form id="auth-form" style="display: flex; flex-direction: column;">
                
                <div id="field-username" class="hidden">
                    <input type="text" id="input-username" placeholder="Name">
                </div>

                <div>
                    <input type="email" id="input-email" required placeholder="Email">
                </div>

                <div>
                    <input type="password" id="input-password" required placeholder="Password">
                </div>

                <button type="submit" id="auth-submit-btn">
                    <span id="auth-btn-text">Sign In</span>
                </button>
            </form>

            <div style="text-align: center; margin-top: 30px;">
                <button id="auth-toggle-btn" style="background: none; border: none; color: var(--ios-blue); font-size: 16px; cursor: pointer;">
                    Create Account
                </button>
            </div>
        </div>
    </div>

    <!-- Main App Structure -->
    <div id="screen-chat" class="app-container hidden">
        
        <!-- SIDEBAR (Contact List) -->
        <aside class="sidebar" id="chat-sidebar">
            <div class="header">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn-icon" style="color: var(--ios-blue); padding-left:0;">Edit</button>
                </div>
                <h3>Messages</h3>
                <div class="user-info" style="display: flex; align-items: center;">
                   <button id="btn-reload-users" class="btn-icon"><i data-lucide="refresh-cw" style="width: 20px;"></i></button>
                   <button id="btn-logout" class="btn-icon" style="margin-left: -5px;"><i data-lucide="log-out" style="width: 20px;"></i></button>
                </div>
            </div>

            <!-- iOS Style Search Bar -->
            <div class="search-container">
                <div class="search-wrapper">
                    <i data-lucide="search" style="color: var(--text-secondary); width: 16px;"></i>
                    <input id="contact-search-input" type="text" placeholder="Search">
                </div>
            </div>

            <div id="users-list" style="overflow-y: auto; flex: 1;">
                <!-- JS will populate users here -->
            </div>
        </aside>

        <!-- MAIN CHAT AREA -->
        <main class="chat-area">
            
            <div id="chat-empty-state" class="flex-center" style="position: absolute; inset: 0; flex-direction: column; opacity: 0.4;">
                <i data-lucide="message-circle" style="width: 60px; height: 60px; color: var(--text-secondary); margin-bottom: 10px;"></i>
                <p style="color: var(--text-secondary); font-size: 15px;">No Chat Selected</p>
            </div>

            <div id="chat-active-container" class="hidden" style="display: flex; flex-direction: column; height: 100%; width: 100%; background: var(--ios-bg);">
                
                <!-- Chat Header (Blur) -->
                <div class="header">
                    <button id="btn-back-list" class="hidden-desktop">
                        <i data-lucide="chevron-left"></i> 
                    </button>
                    
                    <div class="flex-center" style="flex-direction: column; margin: 0 auto; transform: translateY(2px);">
                        <div class="flex-center" style="gap: 6px;">
                            <img id="chat-header-avatar" src="" style="width: 24px; height: 24px; border-radius: 50%;">
                            <span id="chat-header-name" style="font-size: 13px; font-weight: 600;">Name</span>
                        </div>
                        <span style="font-size: 10px; color: var(--text-secondary); margin-top: 1px;">Online</span>
                    </div>

                    <!-- Botão de 'Info' padrão iOS (lado direito) -->
                    <button class="btn-icon">
                        <i data-lucide="info" style="width: 20px;"></i>
                    </button>
                </div>

                <!-- Messages -->
                <div id="messages-list"></div>

                <!-- Input Footer -->
                <form id="message-form">
                    <div class="input-capsule">
                        <button type="button" id="btn-attach" title="Photos"><i data-lucide="plus"></i></button>
                        <input type="text" id="message-input" placeholder="iMessage" autocomplete="off">
                        <button type="submit" class="btn-send"><i data-lucide="arrow-up"></i></button>
                    </div>
                </form>

            </div>
        </main>
    </div>

    <script type="module" src="main.js"></script>
</body>
</html>